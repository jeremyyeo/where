{"version":3,"sources":["ServiceLocation.js","Marker.js","Map.js","index.js"],"names":["Header","styled","div","_templateObject","sleep","ms","Promise","resolve","setTimeout","latestBusLocations","_latestBusLocations","apply","this","arguments","_callee","response","data","services","services2","i","serviceDetails","regenerator_default","a","wrap","_context","prev","next","fetch","sent","json","Services","length","push","map","service","Lat","Long","DelaySeconds","ServiceID","Direction","DestinationStopName","abrupt","t0","stop","ServiceLocation","_this$props","props","activeBusses","busInfo","react_default","createElement","concat","Date","toLocaleString","Component","redIcon","L","Icon","iconUrl","shadowUrl","iconSize","iconAnchor","popupAnchor","shadowSize","greenIcon","Default","prototype","_getIconUrl","mergeOptions","iconRetinaUrl","require","Wrapper","Map_templateObject","width","height","Map","state","location","lat","long","undefined","remove","center","zoom","zoomControl","tileLayer","detectRetina","maxZoom","addTo","marker","bindTooltip","_this2","_this$state$location","resetMap","markings","setInterval","Object","asyncToGenerator","mark","allBusses","busDelayMins","busDelayString","setState","toFixed","Math","abs","icon","error","_this$state","react","ServiceLocation_ServiceLocation","id","React","AppWrapper","src_templateObject","ReactDOM","render","src_Map","stops","document","getElementById"],"mappings":"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","file":"static/js/main.32c55463.chunk.js","sourcesContent":["import React, { Component } from \"react\";\nimport styled from \"styled-components\";\n\nconst Header = styled.div`\n  margin-top: 0px;\n  font-weight: bold;\n  color: navy;\n`;\n\nfunction sleep(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nexport async function latestBusLocations() {\n  try {\n    let response = await fetch(\n      \"https://cors.io/?https://www.metlink.org.nz/api/v1/ServiceLocation/3\"\n    );\n    let data = await response.json();\n    let services = data.Services;\n    await sleep(1000);\n    response = await fetch(\n      \"https://cors.io/?https://www.metlink.org.nz/api/v1/ServiceLocation/27\"\n    );\n    data = await response.json();\n    let services2 = data.Services;\n    for (var i = 0; i < services2.length; i++) {\n      services.push(services2[i]);\n    }\n    const serviceDetails = services.map(service => [\n      +service.Lat,\n      +service.Long,\n      +service.DelaySeconds,\n      +service.ServiceID,\n      service.Direction,\n      service.DestinationStopName\n    ]);\n    return serviceDetails;\n  } catch (error) {\n    return \"An error occured.\";\n  }\n}\n\nexport default class ServiceLocation extends Component {\n  render() {\n    let { activeBusses, busInfo } = this.props;\n    return (\n      <div>\n        <Header>{`${activeBusses} active busses as of ${new Date().toLocaleString()}`}</Header>\n        {/* <pre>{JSON.stringify(busInfo, null, 2)}</pre> */}\n      </div>\n    );\n  }\n}\n","import L from \"leaflet\";\nimport \"leaflet/dist/leaflet.css\";\n\nexport const redIcon = new L.Icon({\n  iconUrl:\n    \"https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png\",\n  shadowUrl:\n    \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png\",\n  iconSize: [20, 30],\n  iconAnchor: [12, 41],\n  popupAnchor: [1, -34],\n  shadowSize: [0, 0]\n});\n\nexport const greenIcon = new L.Icon({\n  iconUrl:\n    \"https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png\",\n  shadowUrl:\n    \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png\",\n  iconSize: [20, 30],\n  iconAnchor: [12, 41],\n  popupAnchor: [1, -34],\n  shadowSize: [0, 0]\n});\n","import React, { Fragment } from \"react\";\nimport L from \"leaflet\";\nimport \"leaflet/dist/leaflet.css\";\nimport styled from \"styled-components\";\nimport ServiceLocation, { latestBusLocations } from \"./ServiceLocation\";\nimport { redIcon, greenIcon } from \"./Marker\";\n\ndelete L.Icon.Default.prototype._getIconUrl;\n\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: require(\"leaflet/dist/images/marker-icon-2x.png\"),\n  iconUrl: require(\"leaflet/dist/images/marker-icon.png\"),\n  shadowUrl: require(\"leaflet/dist/images/marker-shadow.png\")\n});\n\nconst Wrapper = styled.div`\n  width: ${props => props.width};\n  height: ${props => props.height};\n`;\n\nclass Map extends React.Component {\n  state = {\n    location: { lat: -41.301907, long: 174.774041 },\n    activeBusses: 0,\n    busInfo: {}\n  };\n\n  resetMap(lat, long) {\n    if (this.map != undefined) {\n      this.map.remove();\n    }\n    this.map = L.map(\"map\", {\n      center: [lat, long],\n      zoom: 15,\n      zoomControl: false\n    });\n\n    L.tileLayer(\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\", {\n      detectRetina: true,\n      maxZoom: 19\n    }).addTo(this.map);\n\n    L.marker([lat, long])\n      .addTo(this.map)\n      .bindTooltip(\"Wellington\");\n  }\n\n  componentDidMount() {\n    let { lat, long } = this.state.location;\n    this.resetMap(lat, long);\n    let markings = 0;\n\n    setInterval(async () => {\n      if (markings > 200) {\n        this.resetMap(lat, long);\n        markings = 0;\n      }\n      let allBusses = await latestBusLocations();\n      try {\n        this.setState({ activeBusses: allBusses.length, busInfo: allBusses });\n        for (var i = 0; i < allBusses.length; i++) {\n          let busDelayMins = allBusses[i][2] / 60;\n          let busDelayString;\n          // prettier-ignore\n          if (busDelayMins > 0) {\n            busDelayString = `${busDelayMins.toFixed(2)} mins ahead of schedule`;\n          } else if (busDelayMins < 0) {\n            busDelayString = `${Math.abs( busDelayMins.toFixed(2))} mins behind schedule`;\n          } else {\n            busDelayString = \"on time\";\n          }\n\n          L.marker([allBusses[i][0], allBusses[i][1]], {\n            icon: busDelayMins >= 0 ? greenIcon : redIcon\n          })\n            .bindTooltip(\n              `Bus ${allBusses[i][3]} is ${busDelayString} <br/> heading ${\n                allBusses[i][4]\n              } to ${allBusses[i][5]}.`\n            )\n            .addTo(this.map);\n          markings += 1;\n        }\n      } catch (error) {}\n    }, 2000);\n  }\n\n  render() {\n    const { activeBusses, busInfo } = this.state;\n    return (\n      <Fragment>\n        <ServiceLocation activeBusses={activeBusses} busInfo={busInfo} />\n        <Wrapper width=\"100%\" height=\"80vh\" id=\"map\" />\n      </Fragment>\n    );\n  }\n}\n\nexport default Map;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport styled from \"styled-components\";\nimport Map from \"./Map\";\n\nconst AppWrapper = styled.div`\n  display: grid;\n  grid-template-columns: 100%\n  grid-gap: 10px;\n`;\n\nReactDOM.render(\n  <AppWrapper>\n    <Map stops=\"yes\" />\n  </AppWrapper>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}