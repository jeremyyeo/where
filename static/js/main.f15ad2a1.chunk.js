(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{21:function(e,t,n){e.exports=n(37)},26:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var a=n(2),r=n(0),o=n.n(r),c=n(16),i=n.n(c),s=(n(26),n(3)),u=n(4),l=n.n(u),p=n(5),d=n(6),h=n(7),m=n(9),f=n(8),v=n(10),g=n(1),b=n.n(g);n(15);function w(){var e=Object(a.a)(["\n  margin-top: 0px;\n  font-weight: bold;\n  color: navy;\n"]);return w=function(){return e},e}var y=s.a.div(w());function k(){return j.apply(this,arguments)}function j(){return(j=Object(p.a)(l.a.mark(function e(){var t,n,a,r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://cors-anywhere.herokuapp.com/https://www.metlink.org.nz/api/v1/ServiceLocation/3");case 3:return t=e.sent,e.next=6,t.json();case 6:return n=e.sent,a=n.Services,r=a.map(function(e){return{vehicleRef:+e.VehicleRef,serviceID:+e.ServiceID,latLong:[+e.Lat,+e.Long],delaySeconds:+e.DelaySeconds,direction:e.Direction,destination:e.DestinationStopName}}),e.abrupt("return",r);case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return","An error occured.");case 15:case"end":return e.stop()}},e,null,[[0,12]])}))).apply(this,arguments)}var I=function(e){function t(){return Object(d.a)(this,t),Object(m.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.props,t=e.activeBusses;e.busInfo;return o.a.createElement("div",null,o.a.createElement(y,null,"".concat(t," active busses as of ").concat((new Date).toLocaleString())))}}]),t}(r.Component);new b.a.Icon({iconUrl:"https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[20,30],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[0,0]}),new b.a.Icon({iconUrl:"https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[20,30],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[0,0]});function x(){var e=Object(a.a)(["\n  width: ",";\n  height: ",";\n"]);return x=function(){return e},e}delete b.a.Icon.Default.prototype._getIconUrl,b.a.Icon.Default.mergeOptions({iconRetinaUrl:n(34),iconUrl:n(35),shadowUrl:n(36)});var O=s.a.div(x(),function(e){return e.width},function(e){return e.height}),S=function(e){function t(){var e,n;Object(d.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(m.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(r)))).state={location:{lat:-41.301907,long:174.774041},activeBusses:0,busInfo:{}},n}return Object(v.a)(t,e),Object(h.a)(t,[{key:"resetMap",value:function(e,t){void 0!=this.map&&this.map.remove(),this.map=b.a.map("map",{center:[e,t],zoom:15,zoomControl:!1}),b.a.tileLayer("https://api.mapbox.com/styles/v1/jeremyyeo/cjudgff9y1ns31fqd2oq29ark/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1IjoiamVyZW15eWVvIiwiYSI6ImNqdWRnNmNqaTBrbWM0MHBhN2szMHpiOGsifQ.vVwACv-KjPDdi5Bo7GrjKA",{detectRetina:!0,maxZoom:19}).addTo(this.map),b.a.marker([e,t]).addTo(this.map).bindTooltip("Wellington")}},{key:"updateState",value:function(e){this.setState()}},{key:"componentDidMount",value:function(){var e=this,t=this.state.location,n=t.lat,a=t.long;this.resetMap(n,a);var r=0;this.markingsGroup=b.a.featureGroup(),setInterval(Object(p.a)(l.a.mark(function t(){var n,a,o,c;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.map.hasLayer(e.markingsGroup)&&r>1e3&&(e.map.removeLayer(e.markingsGroup),e.markingsGroup.clearLayers(),r=0),t.next=3,k();case 3:n=t.sent;try{for(e.setState({activeBusses:n.length,busInfo:n}),a=0;a<n.length;a++)o=n[a].delaySeconds/60,c=void 0,c=o>0?"".concat(o.toFixed(2)," mins ahead of schedule"):o<0?"".concat(Math.abs(o.toFixed(2))," mins behind schedule"):"on time",b.a.circle(n[a].latLong,{color:o>=0?"green":"red",radius:25}).bindTooltip("Bus ".concat(n[a].serviceID," (").concat(n[a].vehicleRef,") is ").concat(c," <br/> heading ").concat(n[a].direction," to ").concat(n[a].destination,".")).addTo(e.markingsGroup),r+=1}catch(i){}e.map.addLayer(e.markingsGroup);case 6:case"end":return t.stop()}},t)})),5e3)}},{key:"render",value:function(){var e=this.state,t=e.activeBusses,n=e.busInfo;return o.a.createElement(r.Fragment,null,o.a.createElement(I,{activeBusses:t,busInfo:n}),o.a.createElement(O,{width:"100%",height:"80vh",id:"map"}))}}]),t}(o.a.Component);function D(){var e=Object(a.a)(["\n  display: grid;\n  grid-template-columns: 100%\n  grid-gap: 10px;\n"]);return D=function(){return e},e}var L=s.a.div(D());i.a.render(o.a.createElement(L,null,o.a.createElement(S,{stops:"yes"})),document.getElementById("root"))}},[[21,1,2]]]);
//# sourceMappingURL=main.f15ad2a1.chunk.js.map